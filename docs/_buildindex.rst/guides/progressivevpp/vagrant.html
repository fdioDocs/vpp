

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction &mdash; Vector Packet Processor 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="API User Guides" href="../api/index.html" />
    <link rel="prev" title="Progressive VPP Tutorial" href="index.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Vector Packet Processor
          

          
            
            <img src="../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/index.html">Getting Started (Users)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/index.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gstarteddevel/index.html">Getting Started (Developers)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Progressive VPP Tutorial</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-setting-up-your-environment">Exercise: Setting up your environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vagrant-set-up">Vagrant Set Up</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#action-install-virtualbox">Action: Install Virtualbox</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-install-vagrant">Action: Install Vagrant</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-create-a-vagrant-directory">Action: Create a Vagrant Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-vagrantfile">Create a Vagrantfile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-vagrant-up">Action: Vagrant Up</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-ssh-to-vagrant-vm">Action: ssh to Vagrant VM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-install-vpp">Exercise: Install VPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-vpp-basics">Exercise: VPP basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vpp-command-learned-in-this-exercise">VPP command learned in this exercise</a></li>
<li class="toctree-l3"><a class="reference internal" href="#action-remove-dpdk-plugin">Action: Remove dpdk plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#action-run-vpp">Action: Run VPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#action-send-commands-to-vpp-using-vppctl">Action: Send commands to VPP using vppctl</a></li>
<li class="toctree-l3"><a class="reference internal" href="#action-start-a-vpp-shell-using-vppctl">Action: Start a VPP shell using vppctl</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-create-an-interface">Exercise: Create an interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#skills-to-be-learned">Skills to be Learned</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">VPP command learned in this exercise</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-connecting-two-vpp-instances">Exercise: Connecting two vpp instances</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l4"><a class="reference internal" href="#skills-to-be-learned-1">Skills to be Learned</a></li>
<li class="toctree-l4"><a class="reference internal" href="#topology-1">Topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initial-state-1">Initial state</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-running-a-second-vpp-instances">Action: Running a second vpp instances</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-create-memif-interface-on-vpp1">Action: Create memif interface on vpp1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-create-memif-interface-on-vpp2">Action: Create memif interface on vpp2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-ping-from-vpp1-to-vpp2">Action: Ping from vpp1 to vpp2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-routing">Exercise: Routing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">Skills to be Learned</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">vpp command learned in this exercise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">Topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">Initial State</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-setup-host-route">Action: Setup host route</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-return-route-on-vpp2">Setup return route on vpp2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ping-from-host-through-vpp1-to-vpp2">Ping from host through vpp1 to vpp2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-switching">Exercise: Switching</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">Skills to be Learned</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">vpp command learned in this exercise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">Topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">Initial state</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-run-vpp-instances">Action: Run vpp instances</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-connect-vpp1-to-host">Action: Connect vpp1 to host</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-connect-vpp1-to-vpp2">Action: Connect vpp1 to vpp2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-configure-bridge-domain-on-vpp1">Action: Configure Bridge Domain on vpp1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-configure-loopback-interface-on-vpp2">Action: Configure loopback interface on vpp2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-configure-bridge-domain-on-vpp2">Action: Configure bridge domain on vpp2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-ping-from-host-to-vpp-and-vpp-to-host">Action: Ping from host to vpp and vpp to host</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-examine-l2-fib">Action: Examine l2 fib</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#source-nat">Source NAT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">Skills to be Learned</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">vpp command learned in this exercise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">Topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">Initial state</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-install-vpp-plugins">Action: Install vpp-plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-create-vpp-instance">Action: Create vpp instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-create-veth-interfaces">Action: Create veth interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-configure-vpp-outside-interface">Action: Configure vpp outside interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-configure-snat">Action: Configure snat</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-prepare-to-observe-snat">Action: Prepare to Observe Snat</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-ping-via-snat">Action: Ping via snat</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-confirm-snat">Action: Confirm snat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/index.html">API User Guides</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Vector Packet Processor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">User Guides</a> &raquo;</li>
        
          <li><a href="index.html">Progressive VPP Tutorial</a> &raquo;</li>
        
      <li>Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/guides/progressivevpp/vagrant.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound" id="vagrant">
</div>
<div class="section" id="introduction">
<span id="introduction-to-vpp-vagrant"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>This tutorial is designed for you to be able to run it on a single Ubuntu 16.04 VM on your laptop.
It walks you through some very basic vpp senarios, with a focus on learning vpp commands, doing common actions,
and being able to discover common things about the state of a running vpp.</p>
<p>This is <em>not</em> intended to be a ‘how to run in a production environment’ set of instructions.</p>
</div>
<div class="section" id="exercise-setting-up-your-environment">
<h1>Exercise: Setting up your environment<a class="headerlink" href="#exercise-setting-up-your-environment" title="Permalink to this headline">¶</a></h1>
<p>All of these exercises are designed to be performed on an Ubuntu 16.04 (Xenial) box.</p>
<p>If you have an Ubuntu 16.04 box on which you have sudo, you can feel free to use that.</p>
<p>If you do not, a Vagrantfile is provided to setup a basic Ubuntu 16.04 box for you</p>
</div>
<div class="section" id="vagrant-set-up">
<span id="id1"></span><h1>Vagrant Set Up<a class="headerlink" href="#vagrant-set-up" title="Permalink to this headline">¶</a></h1>
<div class="section" id="action-install-virtualbox">
<h2>Action: Install Virtualbox<a class="headerlink" href="#action-install-virtualbox" title="Permalink to this headline">¶</a></h2>
<p>If you do not already have virtualbox on your laptop (or if it is not up to date), please download and install it:</p>
<p><a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></p>
</div>
<div class="section" id="action-install-vagrant">
<h2>Action: Install Vagrant<a class="headerlink" href="#action-install-vagrant" title="Permalink to this headline">¶</a></h2>
<p>If you do not already have Vagrant on your laptop (or if it is not up to date), please download it:</p>
<p><a class="reference external" href="https://www.vagrantup.com/downloads.html">https://www.vagrantup.com/downloads.html</a></p>
</div>
<div class="section" id="action-create-a-vagrant-directory">
<h2>Action: Create a Vagrant Directory<a class="headerlink" href="#action-create-a-vagrant-directory" title="Permalink to this headline">¶</a></h2>
<p>Create a directory on your laptop</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir fdio-tutorial</span>
<span class="go">cd fdio-tutorial/</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-vagrantfile">
<span id="create-vagrant-file"></span><h2>Create a Vagrantfile<a class="headerlink" href="#create-a-vagrantfile" title="Permalink to this headline">¶</a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> -*- mode: ruby -*-
<span class="gp">#</span> vi: <span class="nb">set</span> <span class="nv">ft</span><span class="o">=</span>ruby :

<span class="go">Vagrant.configure(2) do |config|</span>

<span class="go">config.vm.box = &quot;puppetlabs/ubuntu-16.04-64-nocm&quot;</span>
<span class="go">config.vm.box_check_update = false</span>

<span class="go">vmcpu=(ENV[&#39;VPP_VAGRANT_VMCPU&#39;] || 2)</span>
<span class="go">vmram=(ENV[&#39;VPP_VAGRANT_VMRAM&#39;] || 4096)</span>

<span class="go">config.ssh.forward_agent = true</span>

<span class="go">config.vm.provider &quot;virtualbox&quot; do |vb|</span>
<span class="go">    vb.customize [&quot;modifyvm&quot;, :id, &quot;--ioapic&quot;, &quot;on&quot;]</span>
<span class="go">    vb.memory = &quot;#{vmram}&quot;</span>
<span class="go">    vb.cpus = &quot;#{vmcpu}&quot;</span>
<span class="gp">    #</span>support <span class="k">for</span> the SSE4.x instruction is required in some versions of VB.
<span class="go">    vb.customize [&quot;setextradata&quot;, :id, &quot;VBoxInternal/CPUM/SSE4.1&quot;, &quot;1&quot;]</span>
<span class="go">    vb.customize [&quot;setextradata&quot;, :id, &quot;VBoxInternal/CPUM/SSE4.2&quot;, &quot;1&quot;]</span>
<span class="go">end</span>
<span class="go">end</span>
</pre></div>
</div>
</div>
<div class="section" id="action-vagrant-up">
<h2>Action: Vagrant Up<a class="headerlink" href="#action-vagrant-up" title="Permalink to this headline">¶</a></h2>
<p>Bring up your Vagrant VM:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vagrant up</span>
</pre></div>
</div>
</div>
<div class="section" id="action-ssh-to-vagrant-vm">
<h2>Action: ssh to Vagrant VM<a class="headerlink" href="#action-ssh-to-vagrant-vm" title="Permalink to this headline">¶</a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vagrant ssh</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="exercise-install-vpp">
<h1>Exercise: Install VPP<a class="headerlink" href="#exercise-install-vpp" title="Permalink to this headline">¶</a></h1>
<p><strong>Skills to be Learned</strong></p>
<blockquote>
<div><ul class="simple">
<li>Learn how to install vpp binary packges using apt-get.</li>
</ul>
</div></blockquote>
<p>Follow the instructions at <a class="reference internal" href="../../gettingstarted/installing/ubuntu.html#install-vpp"><span class="std std-ref">Installing VPP Binaries</span></a> for installing xenial vpp packages from the release repo.  Please note, certain aspects of this tutorial require vpp 17.10 or later.</p>
</div>
<div class="section" id="exercise-vpp-basics">
<h1>Exercise: VPP basics<a class="headerlink" href="#exercise-vpp-basics" title="Permalink to this headline">¶</a></h1>
<p><strong>Skills to be Learned</strong></p>
<p>By the end of the exercise you should be able to:</p>
<ul class="simple">
<li>Run a vpp instance in a mode which allows multiple vpp processes to run</li>
<li>Issue vpp commands from the unix shell</li>
<li>Run a vpp shell and issue it commands</li>
</ul>
</div>
<div class="section" id="vpp-command-learned-in-this-exercise">
<h1>VPP command learned in this exercise<a class="headerlink" href="#vpp-command-learned-in-this-exercise" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vpp_app.html#clicmd_show_version">show ver</a></li>
</ul>
</div>
<div class="section" id="action-remove-dpdk-plugin">
<h1>Action: Remove dpdk plugin<a class="headerlink" href="#action-remove-dpdk-plugin" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we will be running multiple vpp instances.  DPDK does not work well with multiple instances, and so to run multiple instances we will need to disable the dpdk-plugin by removing it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo rm -rf /usr/lib/vpp_plugins/dpdk_plugin.so</span>
</pre></div>
</div>
<p>..how-to-run-vpp:</p>
</div>
<div class="section" id="action-run-vpp">
<h1>Action: Run VPP<a class="headerlink" href="#action-run-vpp" title="Permalink to this headline">¶</a></h1>
<p>VPP runs in userspace.  In a production environment you will often run it with DPDK to connect to real NICs or vhost to connect to VMs.
In those circumstances you usually run a single instance of vpp.</p>
<p>For purposes of this tutorial, it is going to be extremely useful to run multiple instances of vpp, and connect them to each other to form
a topology.  Fortunately, vpp supports this.</p>
<p>When running multiple vpp instances, each instance needs to have specified a ‘name’ or ‘prefix’.  In the example below, the ‘name’ or ‘prefix’ is “vpp1”. Note that only one instance can use the dpdk plugin, since this plugin is trying to acquire a lock on a file.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo vpp unix {cli-listen /run/vpp/cli-vpp1.sock} api-segment { prefix vpp1 }</span>
</pre></div>
</div>
<p><strong>Example Output:</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vlib_plugin_early_init:230: plugin path /usr/lib/vpp_plugins</span>
</pre></div>
</div>
<p>Please note:</p>
<ul class="simple">
<li>“api-segment {prefix vpp1}” tells vpp how to name the files in /dev/shm/ for your vpp instance differently from the default.</li>
<li>“unix {cli-listen /run/vpp/cli-vpp1.sock}” tells vpp to use a non-default socket file when being addressed by vppctl.</li>
</ul>
<p>If you can’t see the vpp process running on the host, activate the nodaemon option to better understand what is happening</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo vpp unix {nodaemon cli-listen /run/vpp/cli-vpp1.sock} api-segment { prefix vpp1 }</span>
</pre></div>
</div>
<p><strong>Example Output with errors from the dpdk plugin:</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vlib_plugin_early_init:356: plugin path /usr/lib/vpp_plugins</span>
<span class="go">load_one_plugin:184: Loaded plugin: acl_plugin.so (Access Control Lists)</span>
<span class="go">load_one_plugin:184: Loaded plugin: dpdk_plugin.so (Data Plane Development Kit (DPDK))</span>
<span class="go">load_one_plugin:184: Loaded plugin: flowprobe_plugin.so (Flow per Packet)</span>
<span class="go">load_one_plugin:184: Loaded plugin: gtpu_plugin.so (GTPv1-U)</span>
<span class="go">load_one_plugin:184: Loaded plugin: ila_plugin.so (Identifier-locator addressing for IPv6)</span>
<span class="go">load_one_plugin:184: Loaded plugin: ioam_plugin.so (Inbound OAM)</span>
<span class="go">load_one_plugin:114: Plugin disabled (default): ixge_plugin.so</span>
<span class="go">load_one_plugin:184: Loaded plugin: kubeproxy_plugin.so (kube-proxy data plane)</span>
<span class="go">load_one_plugin:184: Loaded plugin: l2e_plugin.so (L2 Emulation)</span>
<span class="go">load_one_plugin:184: Loaded plugin: lb_plugin.so (Load Balancer)</span>
<span class="go">load_one_plugin:184: Loaded plugin: libsixrd_plugin.so (IPv6 Rapid Deployment on IPv4 Infrastructure (RFC5969))</span>
<span class="go">load_one_plugin:184: Loaded plugin: memif_plugin.so (Packet Memory Interface (experimetal))</span>
<span class="go">load_one_plugin:184: Loaded plugin: nat_plugin.so (Network Address Translation)</span>
<span class="go">load_one_plugin:184: Loaded plugin: pppoe_plugin.so (PPPoE)</span>
<span class="go">load_one_plugin:184: Loaded plugin: stn_plugin.so (VPP Steals the NIC for Container integration)</span>
<span class="go">vpp[10211]: vlib_pci_bind_to_uio: Skipping PCI device 0000:00:03.0 as host interface eth0 is up</span>
<span class="go">vpp[10211]: vlib_pci_bind_to_uio: Skipping PCI device 0000:00:04.0 as host interface eth1 is up</span>
<span class="go">vpp[10211]: dpdk_config:1240: EAL init args: -c 1 -n 4 --huge-dir /run/vpp/hugepages --file-prefix vpp -b 0000:00:03.0 -b 0000:00:04.0 --master-lcore 0 --socket-mem 64</span>
<span class="go">EAL: No free hugepages reported in hugepages-1048576kB</span>
<span class="go">EAL: Error - exiting with code: 1</span>
<span class="go">Cause: Cannot create lock on &#39;/var/run/.vpp_config&#39;. Is another primary process running?</span>
</pre></div>
</div>
</div>
<div class="section" id="action-send-commands-to-vpp-using-vppctl">
<h1>Action: Send commands to VPP using vppctl<a class="headerlink" href="#action-send-commands-to-vpp-using-vppctl" title="Permalink to this headline">¶</a></h1>
<p>You can send vpp commands with a utility called <em>vppctl</em>.</p>
<p>When running vppctl against a named version of vpp, you will need to run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo vppctl -s /run/vpp/cli-${name}.sock ${cmd}</span>
</pre></div>
</div>
<p><strong>Note</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/run/vpp/cli-${name}.sock</span>
</pre></div>
</div>
<p>is the particular naming convention used in this tutorial.  By default you can set vpp to use what ever socket file name you would like at startup (the default config file uses /run/vpp/cli.sock) if two different vpps are being run (as in this tutorial) you must use distinct socket files for each one.</p>
<p>So to run ‘show ver’ against the vpp instance named vpp1 you would run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo vppctl -s /run/vpp/cli-vpp1.sock show ver</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vpp v17.04-rc0~177-g006eb47 built by ubuntu on fdio-ubuntu1604-sevt at Mon Jan 30 18:30:12 UTC 2017</span>
</pre></div>
</div>
</div>
<div class="section" id="action-start-a-vpp-shell-using-vppctl">
<h1>Action: Start a VPP shell using vppctl<a class="headerlink" href="#action-start-a-vpp-shell-using-vppctl" title="Permalink to this headline">¶</a></h1>
<p>You can also use vppctl to launch a vpp shell with which you can run multiple vpp commands interactively by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo vppctl -s /run/vpp/cli-${name}.sock</span>
</pre></div>
</div>
<p>which will give you a command prompt.</p>
<p>Try doing show ver that way:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo vppctl -s /run/vpp/cli-vpp1.sock</span>
<span class="go">vpp# show ver</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vpp v17.04-rc0~177-g006eb47 built by ubuntu on fdio-ubuntu1604-sevt at Mon Jan 30 18:30:12 UTC 2017</span>

<span class="go">vpp#</span>
</pre></div>
</div>
<p>To exit the vppctl shell:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vpp# quit</span>
</pre></div>
</div>
</div>
<div class="section" id="exercise-create-an-interface">
<h1>Exercise: Create an interface<a class="headerlink" href="#exercise-create-an-interface" title="Permalink to this headline">¶</a></h1>
<div class="section" id="skills-to-be-learned">
<h2>Skills to be Learned<a class="headerlink" href="#skills-to-be-learned" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Create a veth interface in Linux host</li>
<li>Assign an IP address to one end of the veth interface in the Linux host</li>
<li>Create a vpp host-interface that connected to one end of a veth interface via AF_PACKET</li>
<li>Add an ip address to a vpp interface</li>
<li>Setup a ‘trace’</li>
<li>View a ‘trace’</li>
<li>Clear a ‘trace’</li>
<li>Verify using ping from host</li>
<li>Ping from vpp</li>
<li>Examine Arp Table</li>
<li>Examine ip fib</li>
</ol>
</div>
<div class="section" id="id2">
<h2>VPP command learned in this exercise<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet_devices_af_packet.html#clicmd_create_host-interface">create host-interface</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet.html#clicmd_set_interface_state">set int state</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet_ip.html#clicmd_set_interface_ip_address">set int ip address</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet.html#clicmd_show_hardware-interfaces">show hardware</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet.html#clicmd_show_interfaces">show int</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet.html#clicmd_show_interfaces">show int addr</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vlib.html#clicmd_trace_add">trace add</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vlib.html#clicmd_clear_trace">clear trace</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet_ip.html#clicmd_ping">ping</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet_ethernet.html#clicmd_show_ip_arp">show ip arp</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet_fib.html#clicmd_show_ip_fib">show ip fib</a></li>
</ol>
<div class="section" id="topology">
<h3>Topology<a class="headerlink" href="#topology" title="Permalink to this headline">¶</a></h3>
<div class="figure" id="id18">
<img alt="Figure: Create Interface Topology" src="../../_images/Create_Interface_Topology.jpg" />
<p class="caption"><span class="caption-text">Figure: Create Interface Topology</span></p>
</div>
</div>
<div class="section" id="initial-state">
<h3>Initial State<a class="headerlink" href="#initial-state" title="Permalink to this headline">¶</a></h3>
<p>The initial state here is presumed to be the final state from the
exercise <a class="reference external" href="VPP/Progressive_VPP_Tutorial#Exercise:_vpp_basics">VPP Basics</a></p>
</div>
<div class="section" id="action-create-veth-interfaces-on-host">
<h3>Action: Create veth interfaces on host<a class="headerlink" href="#action-create-veth-interfaces-on-host" title="Permalink to this headline">¶</a></h3>
<p>In Linux, there is a type of interface call ‘veth’. Think of a ‘veth’
interface as being an interface that has two ends to it (rather than
one).</p>
<p>Create a veth interface with one end named <strong>vpp1out</strong> and the other
named <strong>vpp1host</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ip</span> <span class="n">link</span> <span class="n">add</span> <span class="n">name</span> <span class="n">vpp1out</span> <span class="nb">type</span> <span class="n">veth</span> <span class="n">peer</span> <span class="n">name</span> <span class="n">vpp1host</span>
</pre></div>
</div>
<p>Turn up both ends:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">vpp1out</span> <span class="n">up</span>
<span class="n">sudo</span> <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">vpp1host</span> <span class="n">up</span>
</pre></div>
</div>
<p>Assign an IP address</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ip</span> <span class="n">addr</span> <span class="n">add</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">vpp1host</span>
</pre></div>
</div>
<p>Display the result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ip</span> <span class="n">addr</span> <span class="n">show</span> <span class="n">vpp1host</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span><span class="p">:</span> <span class="n">vpp1host</span><span class="nd">@vpp1out</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">97</span><span class="p">:</span><span class="n">e3</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="n">aa</span><span class="p">:</span><span class="n">b8</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>
    <span class="n">inet</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span><span class="o">/</span><span class="mi">24</span> <span class="n">scope</span> <span class="k">global</span> <span class="n">vpp1host</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
    <span class="n">inet6</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">5</span><span class="n">c97</span><span class="p">:</span><span class="n">e3ff</span><span class="p">:</span><span class="n">fe41</span><span class="p">:</span><span class="n">aab8</span><span class="o">/</span><span class="mi">64</span> <span class="n">scope</span> <span class="n">link</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
</pre></div>
</div>
</div>
<div class="section" id="action-create-vpp-host-interface">
<h3>Action: Create vpp host- interface<a class="headerlink" href="#action-create-vpp-host-interface" title="Permalink to this headline">¶</a></h3>
<p>Create a host interface attached to <strong>vpp1out</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">create</span> <span class="n">host</span><span class="o">-</span><span class="n">interface</span> <span class="n">name</span> <span class="n">vpp1out</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>
</pre></div>
</div>
<p>Confirm the interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="n">hardware</span>
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">Name</span>                <span class="n">Idx</span>   <span class="n">Link</span>  <span class="n">Hardware</span>
<span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>                       <span class="mi">1</span>     <span class="n">up</span>   <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>
  <span class="n">Ethernet</span> <span class="n">address</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span>
  <span class="n">Linux</span> <span class="n">PACKET</span> <span class="n">socket</span> <span class="n">interface</span>
<span class="n">local0</span>                             <span class="mi">0</span>    <span class="n">down</span>  <span class="n">local0</span>
  <span class="n">local</span>
</pre></div>
</div>
<p>Turn up the interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="nb">set</span> <span class="nb">int</span> <span class="n">state</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span> <span class="n">up</span>
</pre></div>
</div>
<p>Confirm the interface is up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="nb">int</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">Name</span>               <span class="n">Idx</span>       <span class="n">State</span>          <span class="n">Counter</span>          <span class="n">Count</span>
<span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>                      <span class="mi">1</span>         <span class="n">up</span>
<span class="n">local0</span>                            <span class="mi">0</span>        <span class="n">down</span>
</pre></div>
</div>
<p>Assign ip address 10.10.1.2/24</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="nb">set</span> <span class="nb">int</span> <span class="n">ip</span> <span class="n">address</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span><span class="o">/</span><span class="mi">24</span>
</pre></div>
</div>
<p>Confirm the ip address is assigned:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="nb">int</span> <span class="n">addr</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span> <span class="p">(</span><span class="n">up</span><span class="p">):</span>
  <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span><span class="o">/</span><span class="mi">24</span>
<span class="n">local0</span> <span class="p">(</span><span class="n">dn</span><span class="p">):</span>
</pre></div>
</div>
</div>
<div class="section" id="action-add-trace">
<h3>Action: Add trace<a class="headerlink" href="#action-add-trace" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">trace</span> <span class="n">add</span> <span class="n">af</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="nb">input</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="section" id="action-ping-from-host-to-vpp">
<h3>Action: Ping from host to vpp<a class="headerlink" href="#action-ping-from-host-to-vpp" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ping</span> <span class="o">-</span><span class="n">c</span> <span class="mi">1</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PING</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span> <span class="p">(</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.557</span> <span class="n">ms</span>

<span class="o">---</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
<span class="mi">1</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">1</span> <span class="n">received</span><span class="p">,</span> <span class="mi">0</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span><span class="p">,</span> <span class="n">time</span> <span class="mi">0</span><span class="n">ms</span>
<span class="n">rtt</span> <span class="nb">min</span><span class="o">/</span><span class="n">avg</span><span class="o">/</span><span class="nb">max</span><span class="o">/</span><span class="n">mdev</span> <span class="o">=</span> <span class="mf">0.557</span><span class="o">/</span><span class="mf">0.557</span><span class="o">/</span><span class="mf">0.557</span><span class="o">/</span><span class="mf">0.000</span> <span class="n">ms</span>
</pre></div>
</div>
</div>
<div class="section" id="action-examine-trace-of-ping-from-host-to-vpp">
<h3>Action: Examine Trace of ping from host to vpp<a class="headerlink" href="#action-examine-trace-of-ping-from-host-to-vpp" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="n">trace</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-------------------</span> <span class="n">Start</span> <span class="n">of</span> <span class="n">thread</span> <span class="mi">0</span> <span class="n">vpp_main</span> <span class="o">-------------------</span>
<span class="n">Packet</span> <span class="mi">1</span>

<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">397798</span><span class="p">:</span> <span class="n">af</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">af_packet</span><span class="p">:</span> <span class="n">hw_if_index</span> <span class="mi">1</span> <span class="nb">next</span><span class="o">-</span><span class="n">index</span> <span class="mi">4</span>
    <span class="n">tpacket2_hdr</span><span class="p">:</span>
      <span class="n">status</span> <span class="mh">0x20000001</span> <span class="nb">len</span> <span class="mi">42</span> <span class="n">snaplen</span> <span class="mi">42</span> <span class="n">mac</span> <span class="mi">66</span> <span class="n">net</span> <span class="mi">80</span>
      <span class="n">sec</span> <span class="mh">0x588fd3ac</span> <span class="n">nsec</span> <span class="mh">0x375abde7</span> <span class="n">vlan</span> <span class="mi">0</span> <span class="n">vlan_tpid</span> <span class="mi">0</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">397906</span><span class="p">:</span> <span class="n">ethernet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ARP</span><span class="p">:</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span> <span class="o">-&gt;</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">397912</span><span class="p">:</span> <span class="n">arp</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">request</span><span class="p">,</span> <span class="nb">type</span> <span class="n">ethernet</span><span class="o">/</span><span class="n">IP4</span><span class="p">,</span> <span class="n">address</span> <span class="n">size</span> <span class="mi">6</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">398191</span><span class="p">:</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span><span class="o">-</span><span class="n">output</span>
  <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>
  <span class="n">ARP</span><span class="p">:</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span> <span class="o">-&gt;</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span>
  <span class="n">reply</span><span class="p">,</span> <span class="nb">type</span> <span class="n">ethernet</span><span class="o">/</span><span class="n">IP4</span><span class="p">,</span> <span class="n">address</span> <span class="n">size</span> <span class="mi">6</span><span class="o">/</span><span class="mi">4</span>
  <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">-&gt;</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span>

<span class="n">Packet</span> <span class="mi">2</span>

<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">398227</span><span class="p">:</span> <span class="n">af</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">af_packet</span><span class="p">:</span> <span class="n">hw_if_index</span> <span class="mi">1</span> <span class="nb">next</span><span class="o">-</span><span class="n">index</span> <span class="mi">4</span>
    <span class="n">tpacket2_hdr</span><span class="p">:</span>
      <span class="n">status</span> <span class="mh">0x20000001</span> <span class="nb">len</span> <span class="mi">98</span> <span class="n">snaplen</span> <span class="mi">98</span> <span class="n">mac</span> <span class="mi">66</span> <span class="n">net</span> <span class="mi">80</span>
      <span class="n">sec</span> <span class="mh">0x588fd3ac</span> <span class="n">nsec</span> <span class="mh">0x37615060</span> <span class="n">vlan</span> <span class="mi">0</span> <span class="n">vlan_tpid</span> <span class="mi">0</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">398295</span><span class="p">:</span> <span class="n">ethernet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">IP4</span><span class="p">:</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span> <span class="o">-&gt;</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">398298</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x9b46</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x894c</span><span class="p">,</span> <span class="n">flags</span> <span class="n">DONT_FRAGMENT</span>
  <span class="n">ICMP</span> <span class="n">echo_request</span> <span class="n">checksum</span> <span class="mh">0x83c</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">398300</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">lookup</span>
  <span class="n">fib</span> <span class="mi">0</span> <span class="n">dpo</span><span class="o">-</span><span class="n">idx</span> <span class="mi">5</span> <span class="n">flow</span> <span class="nb">hash</span><span class="p">:</span> <span class="mh">0x00000000</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x9b46</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x894c</span><span class="p">,</span> <span class="n">flags</span> <span class="n">DONT_FRAGMENT</span>
  <span class="n">ICMP</span> <span class="n">echo_request</span> <span class="n">checksum</span> <span class="mh">0x83c</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">398303</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">local</span>
    <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
      <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x9b46</span>
      <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x894c</span><span class="p">,</span> <span class="n">flags</span> <span class="n">DONT_FRAGMENT</span>
    <span class="n">ICMP</span> <span class="n">echo_request</span> <span class="n">checksum</span> <span class="mh">0x83c</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">398305</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x9b46</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x894c</span><span class="p">,</span> <span class="n">flags</span> <span class="n">DONT_FRAGMENT</span>
  <span class="n">ICMP</span> <span class="n">echo_request</span> <span class="n">checksum</span> <span class="mh">0x83c</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">398307</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="n">echo</span><span class="o">-</span><span class="n">request</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x9b46</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x894c</span><span class="p">,</span> <span class="n">flags</span> <span class="n">DONT_FRAGMENT</span>
  <span class="n">ICMP</span> <span class="n">echo_request</span> <span class="n">checksum</span> <span class="mh">0x83c</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">398317</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">balance</span>
  <span class="n">fib</span> <span class="mi">0</span> <span class="n">dpo</span><span class="o">-</span><span class="n">idx</span> <span class="mi">10</span> <span class="n">flow</span> <span class="nb">hash</span><span class="p">:</span> <span class="mh">0x0000000e</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0xbef3</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x659f</span><span class="p">,</span> <span class="n">flags</span> <span class="n">DONT_FRAGMENT</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x103c</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">398318</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">rewrite</span>
  <span class="n">tx_sw_if_index</span> <span class="mi">1</span> <span class="n">dpo</span><span class="o">-</span><span class="n">idx</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">ipv4</span> <span class="n">via</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span><span class="p">:</span> <span class="n">IP4</span><span class="p">:</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span> <span class="o">-&gt;</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span> <span class="n">flow</span> <span class="nb">hash</span><span class="p">:</span> <span class="mh">0x00000000</span>
  <span class="n">IP4</span><span class="p">:</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span> <span class="o">-&gt;</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0xbef3</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x659f</span><span class="p">,</span> <span class="n">flags</span> <span class="n">DONT_FRAGMENT</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x103c</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">398320</span><span class="p">:</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span><span class="o">-</span><span class="n">output</span>
  <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>
  <span class="n">IP4</span><span class="p">:</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span> <span class="o">-&gt;</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0xbef3</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x659f</span><span class="p">,</span> <span class="n">flags</span> <span class="n">DONT_FRAGMENT</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x103c</span>
</pre></div>
</div>
</div>
<div class="section" id="action-clear-trace-buffer">
<h3>Action: Clear trace buffer<a class="headerlink" href="#action-clear-trace-buffer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">clear</span>  <span class="n">trace</span>
</pre></div>
</div>
</div>
<div class="section" id="action-ping-from-vpp-to-host">
<h3>Action: ping from vpp to host<a class="headerlink" href="#action-ping-from-vpp-to-host" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">ping</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=.</span><span class="mi">0865</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=.</span><span class="mi">0914</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">3</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=.</span><span class="mi">0943</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">4</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=.</span><span class="mi">0959</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">5</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=.</span><span class="mi">0858</span> <span class="n">ms</span>

<span class="n">Statistics</span><span class="p">:</span> <span class="mi">5</span> <span class="n">sent</span><span class="p">,</span> <span class="mi">5</span> <span class="n">received</span><span class="p">,</span> <span class="mi">0</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span>
</pre></div>
</div>
</div>
<div class="section" id="action-examine-trace-of-ping-from-vpp-to-host">
<h3>Action: Examine Trace of ping from vpp to host<a class="headerlink" href="#action-examine-trace-of-ping-from-vpp-to-host" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="n">trace</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-------------------</span> <span class="n">Start</span> <span class="n">of</span> <span class="n">thread</span> <span class="mi">0</span> <span class="n">vpp_main</span> <span class="o">-------------------</span>
<span class="n">Packet</span> <span class="mi">1</span>

<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">155326</span><span class="p">:</span> <span class="n">af</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">af_packet</span><span class="p">:</span> <span class="n">hw_if_index</span> <span class="mi">1</span> <span class="nb">next</span><span class="o">-</span><span class="n">index</span> <span class="mi">4</span>
    <span class="n">tpacket2_hdr</span><span class="p">:</span>
      <span class="n">status</span> <span class="mh">0x20000001</span> <span class="nb">len</span> <span class="mi">98</span> <span class="n">snaplen</span> <span class="mi">98</span> <span class="n">mac</span> <span class="mi">66</span> <span class="n">net</span> <span class="mi">80</span>
      <span class="n">sec</span> <span class="mh">0x588fd471</span> <span class="n">nsec</span> <span class="mh">0x161c61ad</span> <span class="n">vlan</span> <span class="mi">0</span> <span class="n">vlan_tpid</span> <span class="mi">0</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">155331</span><span class="p">:</span> <span class="n">ethernet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">IP4</span><span class="p">:</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span> <span class="o">-&gt;</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">155334</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2604</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3e8f</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x1a83</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">155335</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">lookup</span>
  <span class="n">fib</span> <span class="mi">0</span> <span class="n">dpo</span><span class="o">-</span><span class="n">idx</span> <span class="mi">5</span> <span class="n">flow</span> <span class="nb">hash</span><span class="p">:</span> <span class="mh">0x00000000</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2604</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3e8f</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x1a83</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">155336</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">local</span>
    <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
      <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2604</span>
      <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3e8f</span>
    <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x1a83</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">155339</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2604</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3e8f</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x1a83</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">155342</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="n">echo</span><span class="o">-</span><span class="n">reply</span>
  <span class="n">ICMP</span> <span class="n">echo</span> <span class="nb">id</span> <span class="mi">17572</span> <span class="n">seq</span> <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">155349</span><span class="p">:</span> <span class="n">error</span><span class="o">-</span><span class="n">drop</span>
  <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="nb">input</span><span class="p">:</span> <span class="n">unknown</span> <span class="nb">type</span>

<span class="n">Packet</span> <span class="mi">2</span>

<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">155330</span><span class="p">:</span> <span class="n">af</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">af_packet</span><span class="p">:</span> <span class="n">hw_if_index</span> <span class="mi">1</span> <span class="nb">next</span><span class="o">-</span><span class="n">index</span> <span class="mi">4</span>
    <span class="n">tpacket2_hdr</span><span class="p">:</span>
      <span class="n">status</span> <span class="mh">0x20000001</span> <span class="nb">len</span> <span class="mi">98</span> <span class="n">snaplen</span> <span class="mi">98</span> <span class="n">mac</span> <span class="mi">66</span> <span class="n">net</span> <span class="mi">80</span>
      <span class="n">sec</span> <span class="mh">0x588fd472</span> <span class="n">nsec</span> <span class="mh">0x1603e95b</span> <span class="n">vlan</span> <span class="mi">0</span> <span class="n">vlan_tpid</span> <span class="mi">0</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">155337</span><span class="p">:</span> <span class="n">ethernet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">IP4</span><span class="p">:</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span> <span class="o">-&gt;</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">155341</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2565</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3f2e</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x7405</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">155343</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">lookup</span>
  <span class="n">fib</span> <span class="mi">0</span> <span class="n">dpo</span><span class="o">-</span><span class="n">idx</span> <span class="mi">5</span> <span class="n">flow</span> <span class="nb">hash</span><span class="p">:</span> <span class="mh">0x00000000</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2565</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3f2e</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x7405</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">155344</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">local</span>
    <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
      <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2565</span>
      <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3f2e</span>
    <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x7405</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">155346</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2565</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3f2e</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x7405</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">155348</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="n">echo</span><span class="o">-</span><span class="n">reply</span>
  <span class="n">ICMP</span> <span class="n">echo</span> <span class="nb">id</span> <span class="mi">17572</span> <span class="n">seq</span> <span class="mi">2</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">155351</span><span class="p">:</span> <span class="n">error</span><span class="o">-</span><span class="n">drop</span>
  <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="nb">input</span><span class="p">:</span> <span class="n">unknown</span> <span class="nb">type</span>

<span class="n">Packet</span> <span class="mi">3</span>

<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">155331</span><span class="p">:</span> <span class="n">af</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">af_packet</span><span class="p">:</span> <span class="n">hw_if_index</span> <span class="mi">1</span> <span class="nb">next</span><span class="o">-</span><span class="n">index</span> <span class="mi">4</span>
    <span class="n">tpacket2_hdr</span><span class="p">:</span>
      <span class="n">status</span> <span class="mh">0x20000001</span> <span class="nb">len</span> <span class="mi">98</span> <span class="n">snaplen</span> <span class="mi">98</span> <span class="n">mac</span> <span class="mi">66</span> <span class="n">net</span> <span class="mi">80</span>
      <span class="n">sec</span> <span class="mh">0x588fd473</span> <span class="n">nsec</span> <span class="mh">0x15eb77ef</span> <span class="n">vlan</span> <span class="mi">0</span> <span class="n">vlan_tpid</span> <span class="mi">0</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">155337</span><span class="p">:</span> <span class="n">ethernet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">IP4</span><span class="p">:</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span> <span class="o">-&gt;</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">155341</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x249e</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3ff5</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0xf446</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">155343</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">lookup</span>
  <span class="n">fib</span> <span class="mi">0</span> <span class="n">dpo</span><span class="o">-</span><span class="n">idx</span> <span class="mi">5</span> <span class="n">flow</span> <span class="nb">hash</span><span class="p">:</span> <span class="mh">0x00000000</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x249e</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3ff5</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0xf446</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">155345</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">local</span>
    <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
      <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x249e</span>
      <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3ff5</span>
    <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0xf446</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">155349</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x249e</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x3ff5</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0xf446</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">155350</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="n">echo</span><span class="o">-</span><span class="n">reply</span>
  <span class="n">ICMP</span> <span class="n">echo</span> <span class="nb">id</span> <span class="mi">17572</span> <span class="n">seq</span> <span class="mi">3</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">155354</span><span class="p">:</span> <span class="n">error</span><span class="o">-</span><span class="n">drop</span>
  <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="nb">input</span><span class="p">:</span> <span class="n">unknown</span> <span class="nb">type</span>

<span class="n">Packet</span> <span class="mi">4</span>

<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">155335</span><span class="p">:</span> <span class="n">af</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">af_packet</span><span class="p">:</span> <span class="n">hw_if_index</span> <span class="mi">1</span> <span class="nb">next</span><span class="o">-</span><span class="n">index</span> <span class="mi">4</span>
    <span class="n">tpacket2_hdr</span><span class="p">:</span>
      <span class="n">status</span> <span class="mh">0x20000001</span> <span class="nb">len</span> <span class="mi">98</span> <span class="n">snaplen</span> <span class="mi">98</span> <span class="n">mac</span> <span class="mi">66</span> <span class="n">net</span> <span class="mi">80</span>
      <span class="n">sec</span> <span class="mh">0x588fd474</span> <span class="n">nsec</span> <span class="mh">0x15d2ffb6</span> <span class="n">vlan</span> <span class="mi">0</span> <span class="n">vlan_tpid</span> <span class="mi">0</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">155341</span><span class="p">:</span> <span class="n">ethernet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">IP4</span><span class="p">:</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span> <span class="o">-&gt;</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">155346</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2437</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x405c</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x5b6e</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">155347</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">lookup</span>
  <span class="n">fib</span> <span class="mi">0</span> <span class="n">dpo</span><span class="o">-</span><span class="n">idx</span> <span class="mi">5</span> <span class="n">flow</span> <span class="nb">hash</span><span class="p">:</span> <span class="mh">0x00000000</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2437</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x405c</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x5b6e</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">155350</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">local</span>
    <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
      <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2437</span>
      <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x405c</span>
    <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x5b6e</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">155351</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x2437</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x405c</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0x5b6e</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">155353</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="n">echo</span><span class="o">-</span><span class="n">reply</span>
  <span class="n">ICMP</span> <span class="n">echo</span> <span class="nb">id</span> <span class="mi">17572</span> <span class="n">seq</span> <span class="mi">4</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">155356</span><span class="p">:</span> <span class="n">error</span><span class="o">-</span><span class="n">drop</span>
  <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="nb">input</span><span class="p">:</span> <span class="n">unknown</span> <span class="nb">type</span>

<span class="n">Packet</span> <span class="mi">5</span>

<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">155324</span><span class="p">:</span> <span class="n">af</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">af_packet</span><span class="p">:</span> <span class="n">hw_if_index</span> <span class="mi">1</span> <span class="nb">next</span><span class="o">-</span><span class="n">index</span> <span class="mi">4</span>
    <span class="n">tpacket2_hdr</span><span class="p">:</span>
      <span class="n">status</span> <span class="mh">0x20000001</span> <span class="nb">len</span> <span class="mi">98</span> <span class="n">snaplen</span> <span class="mi">98</span> <span class="n">mac</span> <span class="mi">66</span> <span class="n">net</span> <span class="mi">80</span>
      <span class="n">sec</span> <span class="mh">0x588fd475</span> <span class="n">nsec</span> <span class="mh">0x15ba8726</span> <span class="n">vlan</span> <span class="mi">0</span> <span class="n">vlan_tpid</span> <span class="mi">0</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">155331</span><span class="p">:</span> <span class="n">ethernet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">IP4</span><span class="p">:</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span> <span class="o">-&gt;</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">155335</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x23cc</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x40c7</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0xedb3</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">155337</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">lookup</span>
  <span class="n">fib</span> <span class="mi">0</span> <span class="n">dpo</span><span class="o">-</span><span class="n">idx</span> <span class="mi">5</span> <span class="n">flow</span> <span class="nb">hash</span><span class="p">:</span> <span class="mh">0x00000000</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x23cc</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x40c7</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0xedb3</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">155338</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">local</span>
    <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
      <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x23cc</span>
      <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x40c7</span>
    <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0xedb3</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">155341</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ICMP</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
    <span class="n">tos</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ttl</span> <span class="mi">64</span><span class="p">,</span> <span class="n">length</span> <span class="mi">84</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x23cc</span>
    <span class="n">fragment</span> <span class="nb">id</span> <span class="mh">0x40c7</span>
  <span class="n">ICMP</span> <span class="n">echo_reply</span> <span class="n">checksum</span> <span class="mh">0xedb3</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">155343</span><span class="p">:</span> <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="n">echo</span><span class="o">-</span><span class="n">reply</span>
  <span class="n">ICMP</span> <span class="n">echo</span> <span class="nb">id</span> <span class="mi">17572</span> <span class="n">seq</span> <span class="mi">5</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">155346</span><span class="p">:</span> <span class="n">error</span><span class="o">-</span><span class="n">drop</span>
  <span class="n">ip4</span><span class="o">-</span><span class="n">icmp</span><span class="o">-</span><span class="nb">input</span><span class="p">:</span> <span class="n">unknown</span> <span class="nb">type</span>

<span class="n">Packet</span> <span class="mi">6</span>

<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">175185</span><span class="p">:</span> <span class="n">af</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">af_packet</span><span class="p">:</span> <span class="n">hw_if_index</span> <span class="mi">1</span> <span class="nb">next</span><span class="o">-</span><span class="n">index</span> <span class="mi">4</span>
    <span class="n">tpacket2_hdr</span><span class="p">:</span>
      <span class="n">status</span> <span class="mh">0x20000001</span> <span class="nb">len</span> <span class="mi">42</span> <span class="n">snaplen</span> <span class="mi">42</span> <span class="n">mac</span> <span class="mi">66</span> <span class="n">net</span> <span class="mi">80</span>
      <span class="n">sec</span> <span class="mh">0x588fd476</span> <span class="n">nsec</span> <span class="mh">0x16d05dd0</span> <span class="n">vlan</span> <span class="mi">0</span> <span class="n">vlan_tpid</span> <span class="mi">0</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">175195</span><span class="p">:</span> <span class="n">ethernet</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">ARP</span><span class="p">:</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span> <span class="o">-&gt;</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">175200</span><span class="p">:</span> <span class="n">arp</span><span class="o">-</span><span class="nb">input</span>
  <span class="n">request</span><span class="p">,</span> <span class="nb">type</span> <span class="n">ethernet</span><span class="o">/</span><span class="n">IP4</span><span class="p">,</span> <span class="n">address</span> <span class="n">size</span> <span class="mi">6</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">-&gt;</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">175214</span><span class="p">:</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span><span class="o">-</span><span class="n">output</span>
  <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>
  <span class="n">ARP</span><span class="p">:</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span> <span class="o">-&gt;</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span>
  <span class="n">reply</span><span class="p">,</span> <span class="nb">type</span> <span class="n">ethernet</span><span class="o">/</span><span class="n">IP4</span><span class="p">,</span> <span class="n">address</span> <span class="n">size</span> <span class="mi">6</span><span class="o">/</span><span class="mi">4</span>
  <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">-&gt;</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span>
</pre></div>
</div>
<p>After examinging the trace, clear it again.</p>
</div>
<div class="section" id="action-examine-arp-tables">
<h3>Action: Examine arp tables<a class="headerlink" href="#action-examine-arp-tables" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="n">ip</span> <span class="n">arp</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Time</span>           <span class="n">IP4</span>       <span class="n">Flags</span>      <span class="n">Ethernet</span>              <span class="n">Interface</span>
<span class="mf">570.4092</span>    <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span>      <span class="n">D</span>    <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span>       <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>
</pre></div>
</div>
</div>
<div class="section" id="action-examine-routing-table">
<h3>Action: Examine routing table<a class="headerlink" href="#action-examine-routing-table" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="n">ip</span> <span class="n">fib</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipv4</span><span class="o">-</span><span class="n">VRF</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">fib_index</span> <span class="mi">0</span><span class="p">,</span> <span class="n">flow</span> <span class="nb">hash</span><span class="p">:</span> <span class="n">src</span> <span class="n">dst</span> <span class="n">sport</span> <span class="n">dport</span> <span class="n">proto</span>
<span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>
  <span class="n">unicast</span><span class="o">-</span><span class="n">ip4</span><span class="o">-</span><span class="n">chain</span>
  <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">balance</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="mi">0</span> <span class="n">buckets</span><span class="p">:</span><span class="mi">1</span> <span class="n">uRPF</span><span class="p">:</span><span class="mi">0</span> <span class="n">to</span><span class="p">:[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">drop</span> <span class="n">ip4</span>
<span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">32</span>
  <span class="n">unicast</span><span class="o">-</span><span class="n">ip4</span><span class="o">-</span><span class="n">chain</span>
  <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">balance</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="mi">1</span> <span class="n">buckets</span><span class="p">:</span><span class="mi">1</span> <span class="n">uRPF</span><span class="p">:</span><span class="mi">1</span> <span class="n">to</span><span class="p">:[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">drop</span> <span class="n">ip4</span>
<span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span><span class="o">/</span><span class="mi">32</span>
  <span class="n">unicast</span><span class="o">-</span><span class="n">ip4</span><span class="o">-</span><span class="n">chain</span>
  <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">balance</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="mi">10</span> <span class="n">buckets</span><span class="p">:</span><span class="mi">1</span> <span class="n">uRPF</span><span class="p">:</span><span class="mi">9</span> <span class="n">to</span><span class="p">:[</span><span class="mi">5</span><span class="p">:</span><span class="mi">420</span><span class="p">]</span> <span class="n">via</span><span class="p">:[</span><span class="mi">1</span><span class="p">:</span><span class="mi">84</span><span class="p">]]</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span><span class="nd">@5</span><span class="p">]:</span> <span class="n">ipv4</span> <span class="n">via</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span><span class="p">:</span> <span class="n">IP4</span><span class="p">:</span> <span class="mi">02</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a7</span> <span class="o">-&gt;</span> <span class="n">fa</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="n">d9</span><span class="p">:</span><span class="mi">50</span>
<span class="mf">10.10</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>
  <span class="n">unicast</span><span class="o">-</span><span class="n">ip4</span><span class="o">-</span><span class="n">chain</span>
  <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">balance</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="mi">8</span> <span class="n">buckets</span><span class="p">:</span><span class="mi">1</span> <span class="n">uRPF</span><span class="p">:</span><span class="mi">7</span> <span class="n">to</span><span class="p">:[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span><span class="nd">@4</span><span class="p">]:</span> <span class="n">ipv4</span><span class="o">-</span><span class="n">glean</span><span class="p">:</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>
<span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span><span class="o">/</span><span class="mi">32</span>
  <span class="n">unicast</span><span class="o">-</span><span class="n">ip4</span><span class="o">-</span><span class="n">chain</span>
  <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">balance</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="mi">9</span> <span class="n">buckets</span><span class="p">:</span><span class="mi">1</span> <span class="n">uRPF</span><span class="p">:</span><span class="mi">8</span> <span class="n">to</span><span class="p">:[</span><span class="mi">6</span><span class="p">:</span><span class="mi">504</span><span class="p">]]</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span><span class="nd">@2</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">receive</span><span class="p">:</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span> <span class="n">on</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>
<span class="mf">224.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">unicast</span><span class="o">-</span><span class="n">ip4</span><span class="o">-</span><span class="n">chain</span>
  <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">balance</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="mi">3</span> <span class="n">buckets</span><span class="p">:</span><span class="mi">1</span> <span class="n">uRPF</span><span class="p">:</span><span class="mi">3</span> <span class="n">to</span><span class="p">:[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">drop</span> <span class="n">ip4</span>
<span class="mf">240.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">unicast</span><span class="o">-</span><span class="n">ip4</span><span class="o">-</span><span class="n">chain</span>
  <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">balance</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="mi">2</span> <span class="n">buckets</span><span class="p">:</span><span class="mi">1</span> <span class="n">uRPF</span><span class="p">:</span><span class="mi">2</span> <span class="n">to</span><span class="p">:[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">drop</span> <span class="n">ip4</span>
<span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span><span class="o">/</span><span class="mi">32</span>
  <span class="n">unicast</span><span class="o">-</span><span class="n">ip4</span><span class="o">-</span><span class="n">chain</span>
  <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">balance</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="mi">4</span> <span class="n">buckets</span><span class="p">:</span><span class="mi">1</span> <span class="n">uRPF</span><span class="p">:</span><span class="mi">4</span> <span class="n">to</span><span class="p">:[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span><span class="nd">@0</span><span class="p">]:</span> <span class="n">dpo</span><span class="o">-</span><span class="n">drop</span> <span class="n">ip4</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exercise-connecting-two-vpp-instances">
<h1>Exercise: Connecting two vpp instances<a class="headerlink" href="#exercise-connecting-two-vpp-instances" title="Permalink to this headline">¶</a></h1>
<div class="section" id="background">
<span id="background-1"></span><h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>memif is a very high performance, direct memory interface type which can
be used between vpp instances to form a topology. It uses a file socket
for a control channel to set up that shared memory.</p>
</div>
<div class="section" id="skills-to-be-learned-1">
<span id="id3"></span><h2>Skills to be Learned<a class="headerlink" href="#skills-to-be-learned-1" title="Permalink to this headline">¶</a></h2>
<p>You will learn the following new skill in this exercise:</p>
<ol class="arabic simple">
<li>Create a memif interface between two vpp instances</li>
</ol>
<p>You should be able to perform this exercise with the following skills
learned in previous exercises:</p>
<ol class="arabic simple">
<li>Run a second vpp instance</li>
<li>Add an ip address to a vpp interface</li>
<li>Ping from vpp</li>
</ol>
</div>
<div class="section" id="topology-1">
<span id="id4"></span><h2>Topology<a class="headerlink" href="#topology-1" title="Permalink to this headline">¶</a></h2>
<div class="figure" id="id19">
<img alt="Connect two vpp topolgy" src="../../_images/Connecting_two_vpp_instances_with_memif.png" />
<p class="caption"><span class="caption-text">Connect two vpp topolgy</span></p>
</div>
</div>
<div class="section" id="initial-state-1">
<span id="id5"></span><h2>Initial state<a class="headerlink" href="#initial-state-1" title="Permalink to this headline">¶</a></h2>
<p>The initial state here is presumed to be the final state from the
exercise <a class="reference external" href="VPP/Progressive_VPP_Tutorial#Exercise:_Create_an_Interface">Create an
Interface</a></p>
</div>
<div class="section" id="action-running-a-second-vpp-instances">
<span id="action-running-a-second-vpp-instances-1"></span><h2>Action: Running a second vpp instances<a class="headerlink" href="#action-running-a-second-vpp-instances" title="Permalink to this headline">¶</a></h2>
<p>You should already have a vpp instance running named: vpp1.</p>
<p>Run a second vpp instance named: vpp2.</p>
</div>
<div class="section" id="action-create-memif-interface-on-vpp1">
<span id="action-create-memif-interface-on-vpp1-1"></span><h2>Action: Create memif interface on vpp1<a class="headerlink" href="#action-create-memif-interface-on-vpp1" title="Permalink to this headline">¶</a></h2>
<p>Create a memif interface on vpp1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">create</span> <span class="n">memif</span> <span class="nb">id</span> <span class="mi">0</span> <span class="n">master</span>
</pre></div>
</div>
<p>This will create an interface on vpp1 memif0/0 using /run/vpp/memif as
its socket file. The role of vpp1 for this memif inteface is ‘master’.</p>
<p>Use your previously used skills to:</p>
<ol class="arabic simple">
<li>Set the memif0/0 state to up.</li>
<li>Assign IP address 10.10.2.1/24 to memif0/0</li>
<li>Examine memif0/0 via show commands</li>
</ol>
</div>
<div class="section" id="action-create-memif-interface-on-vpp2">
<span id="action-create-memif-interface-on-vpp2-1"></span><h2>Action: Create memif interface on vpp2<a class="headerlink" href="#action-create-memif-interface-on-vpp2" title="Permalink to this headline">¶</a></h2>
<p>We want vpp2 to pick up the ‘slave’ role using the same
run/vpp/memif-vpp1vpp2 socket file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp2</span><span class="o">.</span><span class="n">sock</span> <span class="n">create</span> <span class="n">memif</span> <span class="nb">id</span> <span class="mi">0</span> <span class="n">slave</span>
</pre></div>
</div>
<p>This will create an interface on vpp2 memif0/0 using /run/vpp/memif as
its socket file. The role of vpp1 for this memif inteface is ‘slave’.</p>
<p>Use your previously used skills to:</p>
<ol class="arabic simple">
<li>Set the memif0/0 state to up.</li>
<li>Assign IP address 10.10.2.2/24 to memif0/0</li>
<li>Examine memif0/0 via show commands</li>
</ol>
</div>
<div class="section" id="action-ping-from-vpp1-to-vpp2">
<span id="action-ping-from-vpp1-to-vpp2-1"></span><h2>Action: Ping from vpp1 to vpp2<a class="headerlink" href="#action-ping-from-vpp1-to-vpp2" title="Permalink to this headline">¶</a></h2>
<p>Ping 10.10.2.2 from vpp1</p>
<p>Ping 10.10.2.1 from vpp2</p>
</div>
</div>
<div class="section" id="exercise-routing">
<h1>Exercise: Routing<a class="headerlink" href="#exercise-routing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id6">
<h2>Skills to be Learned<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>In this exercise you will learn these new skills:</p>
<ol class="arabic simple">
<li>Add route to Linux Host routing table</li>
<li>Add route to vpp routing table</li>
</ol>
<p>And revisit the old ones:</p>
<ol class="arabic simple">
<li>Examine vpp routing table</li>
<li>Enable trace on vpp1 and vpp2</li>
<li>ping from host to vpp</li>
<li>Examine and clear trace on vpp1 and vpp2</li>
<li>ping from vpp to host</li>
<li>Examine and clear trace on vpp1 and vpp2</li>
</ol>
</div>
<div class="section" id="id7">
<h2>vpp command learned in this exercise<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet_ip.html#clicmd_ip_route">ip route
add</a></li>
</ol>
</div>
<div class="section" id="id8">
<h2>Topology<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<div class="figure" id="id20">
<img alt="Connect two vpp topology" src="../../_images/Connecting_two_vpp_instances_with_memif.png" />
<p class="caption"><span class="caption-text">Connect two vpp topology</span></p>
</div>
</div>
<div class="section" id="id9">
<h2>Initial State<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>The initial state here is presumed to be the final state from the
exercise <a class="reference external" href="VPP/Progressive_VPP_Tutorial#Connecting_two_vpp_instances">Connecting two vpp
instances</a></p>
</div>
<div class="section" id="action-setup-host-route">
<h2>Action: Setup host route<a class="headerlink" href="#action-setup-host-route" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ip</span> <span class="n">route</span> <span class="n">add</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">2.0</span><span class="o">/</span><span class="mi">24</span> <span class="n">via</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span>
<span class="n">ip</span> <span class="n">route</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.2</span> <span class="n">dev</span> <span class="n">enp0s3</span>
<span class="mf">10.0</span><span class="o">.</span><span class="mf">2.0</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">enp0s3</span>  <span class="n">proto</span> <span class="n">kernel</span>  <span class="n">scope</span> <span class="n">link</span>  <span class="n">src</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.15</span>
<span class="mf">10.10</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">vpp1host</span>  <span class="n">proto</span> <span class="n">kernel</span>  <span class="n">scope</span> <span class="n">link</span>  <span class="n">src</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span>
<span class="mf">10.10</span><span class="o">.</span><span class="mf">2.0</span><span class="o">/</span><span class="mi">24</span> <span class="n">via</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.2</span> <span class="n">dev</span> <span class="n">vpp1host</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-return-route-on-vpp2">
<h2>Setup return route on vpp2<a class="headerlink" href="#setup-return-route-on-vpp2" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp2</span><span class="o">.</span><span class="n">sock</span> <span class="n">ip</span> <span class="n">route</span> <span class="n">add</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>  <span class="n">via</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">2.1</span>
</pre></div>
</div>
</div>
<div class="section" id="ping-from-host-through-vpp1-to-vpp2">
<h2>Ping from host through vpp1 to vpp2<a class="headerlink" href="#ping-from-host-through-vpp1-to-vpp2" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Setup a trace on vpp1 and vpp2</li>
<li>Ping 10.10.2.2 from the host</li>
<li>Examine the trace on vpp1 and vpp2</li>
<li>Clear the trace on vpp1 and vpp2</li>
</ol>
</div>
</div>
<div class="section" id="exercise-switching">
<h1>Exercise: Switching<a class="headerlink" href="#exercise-switching" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id10">
<h2>Skills to be Learned<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Associate an interface with a bridge domain</li>
<li>Create a loopback interaface</li>
<li>Create a BVI (Bridge Virtual Interface) for a bridge domain</li>
<li>Examine a bridge domain</li>
</ol>
</div>
<div class="section" id="id11">
<h2>vpp command learned in this exercise<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet_l2.html#clicmd_show_bridge-domain">show
bridge</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet_l2.html#clicmd_show_bridge-domain">show bridge
detail</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet_l2.html#clicmd_set_interface_l2_bridge">set int l2
bridge</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_vnet_l2.html#clicmd_show_l2fib">show l2fib
verbose</a></li>
</ol>
</div>
<div class="section" id="id12">
<h2>Topology<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<div class="figure" id="id21">
<img alt="Switching Topology" src="../../_images/Switching_Topology.jpg" />
<p class="caption"><span class="caption-text">Switching Topology</span></p>
</div>
</div>
<div class="section" id="id13">
<h2>Initial state<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<p>Unlike previous exercises, for this one you want to start tabula rasa.</p>
<p>Note: You will lose all your existing config in your vpp instances!</p>
<p>To clear existing config from previous exercises run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">-</span><span class="n">ef</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">vpp</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{print $2}&#39;</span><span class="o">|</span> <span class="n">xargs</span> <span class="n">sudo</span> <span class="n">kill</span>
<span class="n">sudo</span> <span class="n">ip</span> <span class="n">link</span> <span class="k">del</span> <span class="n">dev</span> <span class="n">vpp1host</span>
<span class="n">sudo</span> <span class="n">ip</span> <span class="n">link</span> <span class="k">del</span> <span class="n">dev</span> <span class="n">vpp1vpp2</span>
</pre></div>
</div>
</div>
<div class="section" id="action-run-vpp-instances">
<h2>Action: Run vpp instances<a class="headerlink" href="#action-run-vpp-instances" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Run a vpp instance named <strong>vpp1</strong></li>
<li>Run a vpp instance named <strong>vpp2</strong></li>
</ol>
</div>
<div class="section" id="action-connect-vpp1-to-host">
<h2>Action: Connect vpp1 to host<a class="headerlink" href="#action-connect-vpp1-to-host" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Create a veth with one end named vpp1host and the other named
vpp1out.</li>
<li>Connect vpp1out to vpp1</li>
<li>Add ip address 10.10.1.1/24 on vpp1host</li>
</ol>
</div>
<div class="section" id="action-connect-vpp1-to-vpp2">
<h2>Action: Connect vpp1 to vpp2<a class="headerlink" href="#action-connect-vpp1-to-vpp2" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Create a veth with one end named vpp1vpp2 and the other named
vpp2vpp1.</li>
<li>Connect vpp1vpp2 to vpp1.</li>
<li>Connect vpp2vpp1 to vpp2.</li>
</ol>
</div>
<div class="section" id="action-configure-bridge-domain-on-vpp1">
<h2>Action: Configure Bridge Domain on vpp1<a class="headerlink" href="#action-configure-bridge-domain-on-vpp1" title="Permalink to this headline">¶</a></h2>
<p>Check to see what bridge domains already exist, and select the first
bridge domain number not in use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="n">bridge</span><span class="o">-</span><span class="n">domain</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ID</span>   <span class="n">Index</span>   <span class="n">Learning</span>   <span class="n">U</span><span class="o">-</span><span class="n">Forwrd</span>   <span class="n">UU</span><span class="o">-</span><span class="n">Flood</span>   <span class="n">Flooding</span>   <span class="n">ARP</span><span class="o">-</span><span class="n">Term</span>     <span class="n">BVI</span><span class="o">-</span><span class="n">Intf</span>
<span class="mi">0</span>      <span class="mi">0</span>        <span class="n">off</span>        <span class="n">off</span>        <span class="n">off</span>        <span class="n">off</span>        <span class="n">off</span>        <span class="n">local0</span>
</pre></div>
</div>
<p>In the example above, there is bridge domain ID ‘0’ already. Even though
sometimes we might get feedback as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">bridge</span><span class="o">-</span><span class="n">domains</span> <span class="ow">in</span> <span class="n">use</span>
</pre></div>
</div>
<p>the bridge domain ID ‘0’ still exists, where no operations are
supported. For instance, if we try to add host-vpp1out and host-vpp1vpp2
to bridge domain ID 0, we will get nothing setup.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="nb">set</span> <span class="nb">int</span> <span class="n">l2</span> <span class="n">bridge</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span> <span class="mi">0</span>
<span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="nb">set</span> <span class="nb">int</span> <span class="n">l2</span> <span class="n">bridge</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1vpp2</span> <span class="mi">0</span>
<span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="n">bridge</span><span class="o">-</span><span class="n">domain</span> <span class="mi">0</span> <span class="n">detail</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show</span> <span class="n">bridge</span><span class="o">-</span><span class="n">domain</span><span class="p">:</span> <span class="n">No</span> <span class="n">operations</span> <span class="n">on</span> <span class="n">the</span> <span class="n">default</span> <span class="n">bridge</span> <span class="n">domain</span> <span class="n">are</span> <span class="n">supported</span>
</pre></div>
</div>
<p>So we will create bridge domain 1 instead of playing with the default
bridge domain ID 0.</p>
<p>Add host-vpp1out to bridge domain ID 1</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="nb">set</span> <span class="nb">int</span> <span class="n">l2</span> <span class="n">bridge</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Add host-vpp1vpp2 to bridge domain ID1</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="nb">set</span> <span class="nb">int</span> <span class="n">l2</span> <span class="n">bridge</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1vpp2</span>  <span class="mi">1</span>
</pre></div>
</div>
<p>Examine bridge domain 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="n">bridge</span><span class="o">-</span><span class="n">domain</span> <span class="mi">1</span> <span class="n">detail</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BD</span><span class="o">-</span><span class="n">ID</span>   <span class="n">Index</span>   <span class="n">BSN</span>  <span class="n">Age</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span>  <span class="n">Learning</span>  <span class="n">U</span><span class="o">-</span><span class="n">Forwrd</span>  <span class="n">UU</span><span class="o">-</span><span class="n">Flood</span>  <span class="n">Flooding</span>  <span class="n">ARP</span><span class="o">-</span><span class="n">Term</span>  <span class="n">BVI</span><span class="o">-</span><span class="n">Intf</span>
  <span class="mi">1</span>       <span class="mi">1</span>      <span class="mi">0</span>     <span class="n">off</span>        <span class="n">on</span>        <span class="n">on</span>        <span class="n">on</span>        <span class="n">on</span>       <span class="n">off</span>       <span class="n">N</span><span class="o">/</span><span class="n">A</span>

         <span class="n">Interface</span>           <span class="n">If</span><span class="o">-</span><span class="n">idx</span> <span class="n">ISN</span>  <span class="n">SHG</span>  <span class="n">BVI</span>  <span class="n">TxFlood</span>        <span class="n">VLAN</span><span class="o">-</span><span class="n">Tag</span><span class="o">-</span><span class="n">Rewrite</span>
       <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>            <span class="mi">1</span>     <span class="mi">1</span>    <span class="mi">0</span>    <span class="o">-</span>      <span class="o">*</span>                 <span class="n">none</span>
       <span class="n">host</span><span class="o">-</span><span class="n">vpp1vpp2</span>           <span class="mi">2</span>     <span class="mi">1</span>    <span class="mi">0</span>    <span class="o">-</span>      <span class="o">*</span>                 <span class="n">none</span>
</pre></div>
</div>
</div>
<div class="section" id="action-configure-loopback-interface-on-vpp2">
<h2>Action: Configure loopback interface on vpp2<a class="headerlink" href="#action-configure-loopback-interface-on-vpp2" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp2</span><span class="o">.</span><span class="n">sock</span> <span class="n">create</span> <span class="n">loopback</span> <span class="n">interface</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">loop0</span>
</pre></div>
</div>
<p>Add the ip address 10.10.1.2/24 to vpp2 interface loop0. Set the state
of interface loop0 on vpp2 to ‘up’</p>
</div>
<div class="section" id="action-configure-bridge-domain-on-vpp2">
<h2>Action: Configure bridge domain on vpp2<a class="headerlink" href="#action-configure-bridge-domain-on-vpp2" title="Permalink to this headline">¶</a></h2>
<p>Check to see the first available bridge domain ID (it will be 1 in this
case)</p>
<p>Add interface loop0 as a bridge virtual interface (bvi) to bridge domain
1</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp2</span><span class="o">.</span><span class="n">sock</span> <span class="nb">set</span> <span class="nb">int</span> <span class="n">l2</span> <span class="n">bridge</span> <span class="n">loop0</span> <span class="mi">1</span> <span class="n">bvi</span>
</pre></div>
</div>
<p>Add interface vpp2vpp1 to bridge domain 1</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp2</span><span class="o">.</span><span class="n">sock</span> <span class="nb">set</span> <span class="nb">int</span> <span class="n">l2</span> <span class="n">bridge</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp2vpp1</span>  <span class="mi">1</span>
</pre></div>
</div>
<p>Examine the bridge domain and interfaces.</p>
</div>
<div class="section" id="action-ping-from-host-to-vpp-and-vpp-to-host">
<h2>Action: Ping from host to vpp and vpp to host<a class="headerlink" href="#action-ping-from-host-to-vpp-and-vpp-to-host" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Add trace on vpp1 and vpp2</li>
<li>ping from host to 10.10.1.2</li>
<li>Examine and clear trace on vpp1 and vpp2</li>
<li>ping from vpp2 to 10.10.1.1</li>
<li>Examine and clear trace on vpp1 and vpp2</li>
</ol>
</div>
<div class="section" id="action-examine-l2-fib">
<h2>Action: Examine l2 fib<a class="headerlink" href="#action-examine-l2-fib" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="n">l2fib</span> <span class="n">verbose</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">Mac</span> <span class="n">Address</span>     <span class="n">BD</span> <span class="n">Idx</span>           <span class="n">Interface</span>           <span class="n">Index</span>  <span class="n">static</span>  <span class="nb">filter</span>  <span class="n">bvi</span>   <span class="n">Mac</span> <span class="n">Age</span> <span class="p">(</span><span class="nb">min</span><span class="p">)</span>
 <span class="n">de</span><span class="p">:</span><span class="n">ad</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">1</span>            <span class="n">host</span><span class="o">-</span><span class="n">vpp1vpp2</span>           <span class="mi">2</span>       <span class="mi">0</span>       <span class="mi">0</span>     <span class="mi">0</span>      <span class="n">disabled</span>
 <span class="n">c2</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="mi">88</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">7</span><span class="n">b</span><span class="p">:</span><span class="mi">8</span><span class="n">e</span>    <span class="mi">1</span>            <span class="n">host</span><span class="o">-</span><span class="n">vpp1out</span>            <span class="mi">1</span>       <span class="mi">0</span>       <span class="mi">0</span>     <span class="mi">0</span>      <span class="n">disabled</span>
<span class="mi">2</span> <span class="n">l2fib</span> <span class="n">entries</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp2</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="n">l2fib</span> <span class="n">verbose</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">Mac</span> <span class="n">Address</span>     <span class="n">BD</span> <span class="n">Idx</span>           <span class="n">Interface</span>           <span class="n">Index</span>  <span class="n">static</span>  <span class="nb">filter</span>  <span class="n">bvi</span>   <span class="n">Mac</span> <span class="n">Age</span> <span class="p">(</span><span class="nb">min</span><span class="p">)</span>
 <span class="n">de</span><span class="p">:</span><span class="n">ad</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">1</span>                <span class="n">loop0</span>               <span class="mi">2</span>       <span class="mi">1</span>       <span class="mi">0</span>     <span class="mi">1</span>      <span class="n">disabled</span>
 <span class="n">c2</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="mi">88</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">7</span><span class="n">b</span><span class="p">:</span><span class="mi">8</span><span class="n">e</span>    <span class="mi">1</span>            <span class="n">host</span><span class="o">-</span><span class="n">vpp2vpp1</span>           <span class="mi">1</span>       <span class="mi">0</span>       <span class="mi">0</span>     <span class="mi">0</span>      <span class="n">disabled</span>
<span class="mi">2</span> <span class="n">l2fib</span> <span class="n">entries</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="source-nat">
<h1>Source NAT<a class="headerlink" href="#source-nat" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id14">
<h2>Skills to be Learned<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Abusing networks namespaces for fun and profit</li>
<li>Configuring snat address</li>
<li>Configuring snat inside and outside interfaces</li>
</ol>
</div>
<div class="section" id="id15">
<h2>vpp command learned in this exercise<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_plugins_snat.html#clicmd_snat_add_interface_address">snat add interface
address</a></li>
<li><a class="reference external" href="https://docs.fd.io/vpp/17.04/clicmd_src_plugins_snat.html#clicmd_set_interface_snat">set interface
snat</a></li>
</ol>
</div>
<div class="section" id="id16">
<h2>Topology<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<div class="figure" id="id22">
<img alt="SNAT Topology" src="../../_images/SNAT_Topology.jpg" />
<p class="caption"><span class="caption-text">SNAT Topology</span></p>
</div>
</div>
<div class="section" id="id17">
<h2>Initial state<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<p>Unlike previous exercises, for this one you want to start tabula rasa.</p>
<p>Note: You will lose all your existing config in your vpp instances!</p>
<p>To clear existing config from previous exercises run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">-</span><span class="n">ef</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">vpp</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{print $2}&#39;</span><span class="o">|</span> <span class="n">xargs</span> <span class="n">sudo</span> <span class="n">kill</span>
<span class="n">sudo</span> <span class="n">ip</span> <span class="n">link</span> <span class="k">del</span> <span class="n">dev</span> <span class="n">vpp1host</span>
<span class="n">sudo</span> <span class="n">ip</span> <span class="n">link</span> <span class="k">del</span> <span class="n">dev</span> <span class="n">vpp1vpp2</span>
</pre></div>
</div>
</div>
<div class="section" id="action-install-vpp-plugins">
<h2>Action: Install vpp-plugins<a class="headerlink" href="#action-install-vpp-plugins" title="Permalink to this headline">¶</a></h2>
<p>Snat is supported by a plugin, so vpp-plugins need to be installed</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">vpp</span><span class="o">-</span><span class="n">plugins</span>
</pre></div>
</div>
</div>
<div class="section" id="action-create-vpp-instance">
<h2>Action: Create vpp instance<a class="headerlink" href="#action-create-vpp-instance" title="Permalink to this headline">¶</a></h2>
<p>Create one vpp instance named vpp1.</p>
<p>Confirm snat plugin is present:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">show</span> <span class="n">plugins</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Plugin</span> <span class="n">path</span> <span class="ow">is</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">vpp_plugins</span>
<span class="n">Plugins</span> <span class="n">loaded</span><span class="p">:</span>
 <span class="mf">1.</span><span class="n">ioam_plugin</span><span class="o">.</span><span class="n">so</span>
 <span class="mf">2.</span><span class="n">ila_plugin</span><span class="o">.</span><span class="n">so</span>
 <span class="mf">3.</span><span class="n">acl_plugin</span><span class="o">.</span><span class="n">so</span>
 <span class="mf">4.</span><span class="n">flowperpkt_plugin</span><span class="o">.</span><span class="n">so</span>
 <span class="mf">5.</span><span class="n">snat_plugin</span><span class="o">.</span><span class="n">so</span>
 <span class="mf">6.</span><span class="n">libsixrd_plugin</span><span class="o">.</span><span class="n">so</span>
 <span class="mf">7.</span><span class="n">lb_plugin</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
</div>
<div class="section" id="action-create-veth-interfaces">
<h2>Action: Create veth interfaces<a class="headerlink" href="#action-create-veth-interfaces" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Create a veth interface with one end named vpp1outside and the other
named vpp1outsidehost</li>
<li>Assign IP address 10.10.1.1/24 to vpp1outsidehost</li>
<li>Create a veth interface with one end named vpp1inside and the other
named vpp1insidehost</li>
<li>Assign IP address 10.10.2.1/24 to vpp1outsidehost</li>
</ol>
<p>Because we’d like to be able to route *via* our vpp instance to an
interface on the same host, we are going to put vpp1insidehost into a
network namespace</p>
<p>Create a new network namespace ‘inside’</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ip</span> <span class="n">netns</span> <span class="n">add</span> <span class="n">inside</span>
</pre></div>
</div>
<p>Move interface vpp1inside into the ‘inside’ namespace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">vpp1insidehost</span> <span class="n">up</span> <span class="n">netns</span> <span class="n">inside</span>
</pre></div>
</div>
<p>Assign an ip address to vpp1insidehost</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">inside</span> <span class="n">ip</span> <span class="n">addr</span> <span class="n">add</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">2.1</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">vpp1insidehost</span>
</pre></div>
</div>
<p>Create a route inside the netns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">inside</span> <span class="n">ip</span> <span class="n">route</span> <span class="n">add</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="n">via</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">2.2</span>
</pre></div>
</div>
</div>
<div class="section" id="action-configure-vpp-outside-interface">
<h2>Action: Configure vpp outside interface<a class="headerlink" href="#action-configure-vpp-outside-interface" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Create a vpp host interface connected to vpp1outside</li>
<li>Assign ip address 10.10.1.2/24</li>
<li>Create a vpp host interface connected to vpp1inside</li>
<li>Assign ip address 10.10.2.2/24</li>
</ol>
</div>
<div class="section" id="action-configure-snat">
<h2>Action: Configure snat<a class="headerlink" href="#action-configure-snat" title="Permalink to this headline">¶</a></h2>
<p>Configure snat to use the address of host-vpp1outside</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="n">snat</span> <span class="n">add</span> <span class="n">interface</span> <span class="n">address</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1outside</span>
</pre></div>
</div>
<p>Configure snat inside and outside interfaces</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vppctl</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">-</span><span class="n">vpp1</span><span class="o">.</span><span class="n">sock</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">snat</span> <span class="ow">in</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1inside</span> <span class="n">out</span> <span class="n">host</span><span class="o">-</span><span class="n">vpp1outside</span>
</pre></div>
</div>
</div>
<div class="section" id="action-prepare-to-observe-snat">
<h2>Action: Prepare to Observe Snat<a class="headerlink" href="#action-prepare-to-observe-snat" title="Permalink to this headline">¶</a></h2>
<p>Observing snat in this configuration is interesting. To do so, vagrant
ssh a second time into your VM and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">tcpdump</span> <span class="o">-</span><span class="n">s</span> <span class="mi">0</span> <span class="o">-</span><span class="n">i</span> <span class="n">vpp1outsidehost</span>
</pre></div>
</div>
<p>Also enable tracing on vpp1</p>
</div>
<div class="section" id="action-ping-via-snat">
<h2>Action: Ping via snat<a class="headerlink" href="#action-ping-via-snat" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">inside</span> <span class="n">ping</span> <span class="o">-</span><span class="n">c</span> <span class="mi">1</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">1.1</span>
</pre></div>
</div>
</div>
<div class="section" id="action-confirm-snat">
<h2>Action: Confirm snat<a class="headerlink" href="#action-confirm-snat" title="Permalink to this headline">¶</a></h2>
<p>Examine the tcpdump output and vpp1 trace to confirm snat occurred.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api/index.html" class="btn btn-neutral float-right" title="API User Guides" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Progressive VPP Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, John DeNisco.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>