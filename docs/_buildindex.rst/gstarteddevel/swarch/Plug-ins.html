

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Plug-ins (src/plugins) &mdash; Vector Packet Processor 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Feature Arcs" href="featurearcs.html" />
    <link rel="prev" title="Application Shell (src/vpp)" href="Application_Shell.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Vector Packet Processor
          

          
            
            <img src="../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/index.html">Getting Started (Users)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/index.html">Use Cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Getting Started (Developers)</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Infrastructure.html">Infrastructure</a></li>
<li class="toctree-l3"><a class="reference internal" href="Network_Stack_Layer.html">Network Stack Layer (src/vnet)</a></li>
<li class="toctree-l3"><a class="reference internal" href="Application_Shell.html">Application Shell (src/vpp)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Plug-ins (src/plugins)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#debug-cli">Debug CLI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#packet-tracer">Packet tracer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="featurearcs.html">Feature Arcs</a></li>
<li class="toctree-l3"><a class="reference internal" href="bihash.html">Bounded-index Extensible Hashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="bihash.html#bihash-cookbook">Bihash Cookbook</a></li>
<li class="toctree-l3"><a class="reference internal" href="bihash.html#creating-a-new-template-instance">Creating a new template instance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/index.html">User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Vector Packet Processor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Getting Started (Developers)</a> &raquo;</li>
        
          <li><a href="index.html">Overview</a> &raquo;</li>
        
      <li>Plug-ins (src/plugins)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/gstarteddevel/swarch/Plug-ins.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="plug-ins-src-plugins">
<h1>Plug-ins (src/plugins)<a class="headerlink" href="#plug-ins-src-plugins" title="Permalink to this headline">¶</a></h1>
<p>vlib implements a straightforward plug-in DLL
mechanism. VLIB client applications specify a directory to search for
plug-in .DLLs, and a name filter to apply (if desired). VLIB needs to
load plug-ins very early.</p>
<p>Once loaded, the plug-in DLL mechanism uses dlsym to find and verify
a vlib_plugin_registration data structure in the newly-loaded
plug-in.</p>
<div class="section" id="debug-cli">
<h2>Debug CLI<a class="headerlink" href="#debug-cli" title="Permalink to this headline">¶</a></h2>
<p>Adding debug CLI commands to VLIB applications is very simple.</p>
<p>Here is a complete example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">clib_error_t</span> <span class="o">*</span>
<span class="n">show_ip_tuple_match</span> <span class="p">(</span><span class="n">vlib_main_t</span> <span class="o">*</span> <span class="n">vm</span><span class="p">,</span>
                     <span class="n">unformat_input_t</span> <span class="o">*</span> <span class="nb">input</span><span class="p">,</span>
                     <span class="n">vlib_cli_command_t</span> <span class="o">*</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">vlib_cli_output</span> <span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="s2">&quot;%U</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">format_ip_tuple_match_tables</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">routing_main</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">static</span> <span class="n">VLIB_CLI_COMMAND</span> <span class="p">(</span><span class="n">show_ip_tuple_command</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;show ip tuple match&quot;</span><span class="p">,</span>
    <span class="o">.</span><span class="n">short_help</span> <span class="o">=</span> <span class="s2">&quot;Show ip 5-tuple match-and-broadcast tables&quot;</span><span class="p">,</span>
    <span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">show_ip_tuple_match</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This example implements the “show ip tuple match” debug cli
command. In ordinary usage, the vlib cli is available via the “vppctl”
applicationn, which sends traffic to a named pipe. One can configure
debug CLI telnet access on a configurable port.</p>
<p>The cli implementation has an output redirection facility which makes
it simple to deliver cli output via shared-memory API messaging,</p>
<p>Particularly for debug or “show tech support” type commands, it would
be wasteful to write vlib application code to pack binary data, write
more code elsewhere to unpack the data and finally print the
answer. If a certain cli command has the potential to hurt packet
processing performance by running for too long, do the work
incrementally in a process node. The client can wait.</p>
</div>
<div class="section" id="packet-tracer">
<h2>Packet tracer<a class="headerlink" href="#packet-tracer" title="Permalink to this headline">¶</a></h2>
<p>Vlib includes a frame element [packet] trace facility, with a simple
vlib cli interface. The cli is straightforward: “trace add
&lt;input-node-name&gt; &lt;count&gt;”.</p>
<p>To trace 100 packets on a typical x86_64 system running the dpdk
plugin: “trace add dpdk-input 100”. When using the packet generator:
“trace add pg-input 100”</p>
<p>Each graph node has the opportunity to capture its own trace data. It
is almost always a good idea to do so. The trace capture APIs are
simple.</p>
<p>The packet capture APIs snapshoot binary data, to minimize processing
at capture time. Each participating graph node initialization provides
a vppinfra format-style user function to pretty-print data when required
by the VLIB “show trace” command.</p>
<p>Set the VLIB node registration “.format_trace” member to the name of the per-graph node format function.</p>
<p>Here’s a simple example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u8</span> <span class="o">*</span> <span class="n">my_node_format_trace</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="n">va_list</span> <span class="o">*</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">vlib_main_t</span> <span class="o">*</span> <span class="n">vm</span> <span class="o">=</span> <span class="n">va_arg</span> <span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">vlib_main_t</span> <span class="o">*</span><span class="p">);</span>
    <span class="n">vlib_node_t</span> <span class="o">*</span> <span class="n">node</span> <span class="o">=</span> <span class="n">va_arg</span> <span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">vlib_node_t</span> <span class="o">*</span><span class="p">);</span>
    <span class="n">my_node_trace_t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">=</span> <span class="n">va_arg</span> <span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">my_trace_t</span> <span class="o">*</span><span class="p">);</span>

    <span class="n">s</span> <span class="o">=</span> <span class="nb">format</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;My trace data was: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">-&gt;&lt;</span><span class="n">whatever</span><span class="o">&gt;</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The trace framework hands the per-node format function the data it
captured as the packet whizzed by. The format function pretty-prints
the data as desired.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="featurearcs.html" class="btn btn-neutral float-right" title="Feature Arcs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Application_Shell.html" class="btn btn-neutral" title="Application Shell (src/vpp)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, John DeNisco.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>